<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="Git2docker.io : ">

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Git2docker.io</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/cooltrick/git2docker.io">View on GitHub</a>

          <h1 id="project_title">Git2docker.io</h1>
          <h2 id="project_tagline"></h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/cooltrick/git2docker.io/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/cooltrick/git2docker.io/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h3>
<a id="git2docker--server" class="anchor" href="#git2docker--server" aria-hidden="true"><span class="octicon octicon-link"></span></a>﻿Git2Docker – Server</h3>

<ul>
<li>Install</li>
</ul>

<p>OS: Opensuse 13.2</p>

<pre><code>zypper install docker
systemctl enable docker
systemctl start docker
systemctl enable sshd
systemctl start sshd
</code></pre>

<p><em>Disable the Firewall</em>.</p>

<p>Installing - Git2Docker</p>

<pre><code>curl https://raw.githubusercontent.com/cooltrick/git2docker.io/master/install.sh | sh
</code></pre>

<ul>
<li>Creating the user:</li>
</ul>

<pre><code>useradd -m user
gpasswd -a user docker
passwd user
</code></pre>

<h3>
<a id="git2docker--client" class="anchor" href="#git2docker--client" aria-hidden="true"><span class="octicon octicon-link"></span></a>﻿Git2Docker – Client</h3>

<pre><code>mkdir ~/.git2docker
ssh-keygen -t dsa
cp -rf ~/.ssh/id_rsa* ~/.git2docker/
cat ~/.git2docker/id_rsa.pub | ssh user@192.168.100.56 git2docker
</code></pre>

<ul>
<li>Downloading and installing the git2docker-cli.</li>
</ul>

<pre><code>curl https://github.com/cooltrick/git2docker.io/raw/master/git2docker-client/linux/git2docker
chmod +x git2docker

cat &gt;  ~/.git2docker/git2docker.conf &lt;&lt;EOF
user=user
host=192.168.100.56
EOF

</code></pre>

<h3>
<a id="about-git2dockerconf" class="anchor" href="#about-git2dockerconf" aria-hidden="true"><span class="octicon octicon-link"></span></a>About git2docker.conf</h3>

<p>The file git2docker.conf is necessary, the server read the file and get needed options to work.</p>

<p><strong>git2docker.conf</strong>:</p>

<p>state options:</p>

<ul>
<li>build - Build the application using the source code.</li>
<li>build:logs - Build the application using the source code and start the container showing logs.</li>
<li>delete or remove - Stop and remove the Container</li>
<li>stop - Stop the Container</li>
<li>start - Start a stoped Container</li>
<li>start:logs - Start a stoped Container and show logs</li>
<li>logs - Show logs of a Started Container</li>
<li>dockerfile or Dockerfile - Force the git2docker to use a Dockerfile</li>
</ul>

<p>example:</p>

<pre><code>state=build
</code></pre>

<p>domain option:</p>

<blockquote>
<p>Provided your DNS is setup to forward your domain to the a host running nginx-proxy, the request will be routed to a container with the domain setted in git2docker.conf.</p>
</blockquote>

<p>example:</p>

<pre><code>domain=app.linux.site
</code></pre>

<p>pre-exec option:</p>

<blockquote>
<p>Option used to execute a command before start the application.</p>
</blockquote>

<p>example:</p>

<pre><code>pre-exec=bundle exec rake db:create db:migrate db:seed
</code></pre>

<p>git Option:</p>

<blockquote>
<p>If you have your code at an external repository like github, git2docker will download and deploy the application.</p>
</blockquote>

<p>example:</p>

<pre><code>git=https://github.com/heroku/node-js-sample
</code></pre>

<p>Exemple of git2docker.conf</p>

<pre><code>state=build
domain=app.domain.lnx
pre-exec=bundle exec rake db:create db:migrate db:seed
</code></pre>

<h3>
<a id="deploy" class="anchor" href="#deploy" aria-hidden="true"><span class="octicon octicon-link"></span></a>Deploy:</h3>

<p>We will deploy a Node.js example application which starts a minimal HTTP server.</p>

<pre><code>git clone https://github.com/heroku/node-js-sample
cd node-js-sample
git init

echo state=build &gt; git2docker.conf
git add --all
git commit -m "build"
git remote add git2docker user@192.168.100.56:node-js-sample

git push git2docker master
</code></pre>

<pre><code>@linux:/tmp/node-js-sample&gt; git push git2docker master
Counting objects: 391, done.
Delta compression using up to 4 threads.
Compressing objects: 100% (316/316), done.
Writing objects: 100% (391/391), 214.55 KiB | 0 bytes/s, done.
Total 391 (delta 46), reused 387 (delta 45)
remote: =======&gt; Working - node-js-sample
remote:
-----&gt; Using u1000 to run an application
-----&gt; Node.js app detected

-----&gt; Reading application state
       package.json...
       build directory...
       cache directory...
       environment variables...

       Node engine:         0.12.x
       Npm engine:          unspecified
       Start mechanism:     npm start
       node_modules source: npm-shrinkwrap.json
       node_modules cached: false

       NPM_CONFIG_PRODUCTION=true
       NODE_MODULES_CACHE=true

-----&gt; Installing binaries
       Resolving node version 0.12.x via semver.io...
       Downloading and installing node 0.12.2...
       Using default npm version: 2.7.4

-----&gt; Building dependencies
       Installing node modules
       express@4.12.3 node_modules/express
       ├── merge-descriptors@1.0.0
       ├── utils-merge@1.0.0
       ├── cookie-signature@1.0.6
       ├── methods@1.1.1
       ├── fresh@0.2.4
       ├── escape-html@1.0.1
       ├── cookie@0.1.2
       ├── range-parser@1.0.2
       ├── content-type@1.0.1
       ├── finalhandler@0.3.4
       ├── vary@1.0.0
       ├── parseurl@1.3.0
       ├── serve-static@1.9.2
       ├── content-disposition@0.5.0
       ├── path-to-regexp@0.1.3
       ├── depd@1.0.1
       ├── qs@2.4.1
       ├── etag@1.5.1 (crc@3.2.1)
       ├── on-finished@2.2.0 (ee-first@1.1.0)
       ├── debug@2.1.3 (ms@0.7.0)
       ├── proxy-addr@1.0.7 (forwarded@0.1.0, ipaddr.js@0.1.9)
       ├── send@0.12.2 (destroy@1.0.3, ms@0.7.0, mime@1.3.4)
       ├── accepts@1.2.5 (negotiator@0.5.1, mime-types@2.0.10)
       └── type-is@1.6.1 (media-typer@0.3.0, mime-types@2.0.10)

-----&gt; Checking startup method
       No Procfile; Adding 'web: npm start' to new Procfile

-----&gt; Finalizing build
       Creating runtime environment
       Exporting binary paths
       Cleaning npm artifacts
       Cleaning previous cache
       Caching results for future builds

-----&gt; Build succeeded!

       node-js-sample@0.2.0 /tmp/build
       └── express@4.12.3

-----&gt; Discovering process types
       Procfile declares types -&gt; web
remote: node-js-sample Started
remote: 49153
To demo@localhost:node-js-sample
* [new branch]      master -&gt; master



@linux:/tmp/node-js-sample&gt; curl http://192.168.100.56:49153/
Hello World!
</code></pre>

<h3>
<a id="deploy---using-a-dockerfile" class="anchor" href="#deploy---using-a-dockerfile" aria-hidden="true"><span class="octicon octicon-link"></span></a>Deploy - Using a Dockerfile</h3>

<p>We will deploy a Apache(httpd) example application.</p>

<pre><code>mkdir apache-demo
cd apache-demo

echo "FROM httpd:2.4" &gt; Dockerfile
echo "EXPOSE 80" &gt;&gt; Dockerfile

echo state=dockerfile &gt; git2docker.conf

git add --all
git commit -m "build"
git remote add git2docker user@192.168.100.56:apache-demo

git push git2docker master
</code></pre>

<pre><code>@linux:/tmp/apache-demo&gt; git push git2docker master
Counting objects: 4, done.
Delta compression using up to 4 threads.
Compressing objects: 100% (2/2), done.
Writing objects: 100% (4/4), 303 bytes | 0 bytes/s, done.
Total 4 (delta 0), reused 0 (delta 0)
remote: =======&gt; Working - apache-demo
remote:
remote: Sending build context to Docker daemon 3.072 kB
remote: Sending build context to Docker daemon
remote: Step 0 : FROM httpd:2.4
remote:  ---&gt; 4ea677a2d898
remote: Step 1 : EXPOSE 80
remote:  ---&gt; Running in 2fe3a7300cdf
remote:  ---&gt; 11d40bb1d4fe
remote: Removing intermediate container 2fe3a7300cdf
remote: Successfully built 11d40bb1d4fe
remote: apache-demo Started
remote: 49154
To demo@localhost:apache-demo
 * [new branch]      master -&gt; master


@linux:/tmp/node-js-sample&gt; curl http://192.168.100.56:49154/
It works!
</code></pre>

<h3>
<a id="manage-containers---git-client" class="anchor" href="#manage-containers---git-client" aria-hidden="true"><span class="octicon octicon-link"></span></a>Manage Containers - Git Client</h3>

<ul>
<li>Deleting:</li>
</ul>

<pre><code>echo state=remove &gt; git2docker.conf
git add --all
git commit -m "build"
git push git2docker master

</code></pre>

<ul>
<li>Stoping:</li>
</ul>

<pre><code>echo state=stop &gt; git2docker.conf
git add --all
git commit -m "build"
git push git2docker master

</code></pre>

<ul>
<li>Starting:</li>
</ul>

<pre><code>echo state=start &gt; git2docker.conf
git add --all
git commit -m "build"
git push git2docker master

</code></pre>

<ul>
<li>Logs:</li>
</ul>

<pre><code>echo state=logs &gt; git2docker.conf
git add --all
git commit -m "build"
git push git2docker master

</code></pre>

<h3>
<a id="manage-containers---git2docker-cli-client" class="anchor" href="#manage-containers---git2docker-cli-client" aria-hidden="true"><span class="octicon octicon-link"></span></a>Manage Containers - Git2Docker-CLI Client</h3>

<pre><code>
curl https://github.com/cooltrick/git2docker.io/raw/master/git2docker-client/linux/git2docker
chmod +x git2docker
</code></pre>

<ul>
<li>Listing:</li>
</ul>

<pre><code>
./git2docker -ps
| apache-demo                    is Up |
</code></pre>

<ul>
<li>Stopting:</li>
</ul>

<pre><code>
./git2docker -stop --name=apache-demo
| apache-demo                   Stoped |
</code></pre>

<ul>
<li>Starting:</li>
</ul>

<pre><code>
./git2docker -start --name=apache-demo
| apache-demo                  Started |
</code></pre>

<ul>
<li>Logs:</li>
</ul>

<pre><code>
./git2docker -logs --name=apache-demo
172.17.0.3 - - [16/Apr/2015:15:08:45 +0000] "GET / HTTP/1.1" 200 22698 "-" "
172.17.0.3 - - [16/Apr/2015:15:08:45 +0000] "GET / HTTP/1.1" 200 22698 "-" "
172.17.0.3 - - [16/Apr/2015:15:08:45 +0000] "GET / HTTP/1.1" 200 22698 "-" "
172.17.0.3 - - [16/Apr/2015:15:08:45 +0000] "GET / HTTP/1.1" 200 22698 "-" "
172.17.0.3 - - [16/Apr/2015:15:08:45 +0000] "GET / HTTP/1.1" 200 22698 "-" "
172.17.0.3 - - [16/Apr/2015:15:08:45 +0000] "GET / HTTP/1.1" 200 22698 "-" "
</code></pre>

<ul>
<li>Deleting:</li>
</ul>

<pre><code>./git2docker -remove --name=apache-demo
Please type yes or no and then press enter: yes
| apache-demo                  Deleted |
</code></pre>

<h4>
<a id="nginx-proxy" class="anchor" href="#nginx-proxy" aria-hidden="true"><span class="octicon octicon-link"></span></a>Nginx proxy:</h4>

<blockquote>
<p>If you not set the domain option, the nginx-proxy will publish the domain using appname.username</p>
</blockquote>

<ul>
<li>Create a systemd service:</li>
</ul>

<pre><code>cd /etc/systemd/system

cat &gt;  nginx-proxy.service  &lt;&lt;EOF
[Unit]
Description=nginx-proxy
After=docker.service
Requires=docker.service

[Service]
TimeoutStartSec=0
ExecStartPre=-/usr/bin/docker kill nginx-proxy
ExecStartPre=-/usr/bin/docker rm nginx-proxy
ExecStartPre=/usr/bin/docker pull jwilder/nginx-proxy
ExecStart=/usr/bin/docker run -d --name=nginx-proxy -p 80:80 -v /var/run/docker.sock:/tmp/docker.sock jwilder/nginx-proxy

[Install]
WantedBy=multi-user.target
EOF
</code></pre>

<ul>
<li>Enable and Start service:</li>
</ul>

<pre><code>systemctl enable /etc/systemd/system/nginx-proxy.service
systemctl start nginx-proxy.service
</code></pre>

<p>Deploy any Container setting domain option in git2docker.conf and test.</p>

<blockquote>
<p>If you haven't a DNS server, You can add the domain at /etc/hosts.</p>
</blockquote>

<p>Example of /etc/hosts file:</p>

<pre><code>192.168.100.56  apache-demo.git2docker
192.168.100.56  nodejs.git2docker
</code></pre>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Git2docker.io maintained by <a href="https://github.com/cooltrick">cooltrick</a></p>
        <p>Published with <a href="https://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

              <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-62067022-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>


  </body>
</html>
